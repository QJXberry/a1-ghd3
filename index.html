<!-- 在 moveCircleToDog 函数结束时移除连接线 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Dog visualization</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      cursor: pointer;
    }

    svg {
      background-color: #7FB3D5;
    }
  </style>
</head>
<body>

<script>
  const svg = d3.select("body").append("svg")
    .attr("width", 1600)  // 放大2倍
    .attr("height", 800)  // 放大2倍
    .style("background-color", "#7FB3D5");

  const dogGroup = svg.append("g");

  // 绘制操场矩形（红色）
  svg.append("rect")
    .attr("x", 0)
    .attr("y", 400)  // 放大2倍
    .attr("width", 1600)  // 放大2倍
    .attr("height", 400)  // 放大2倍
    .attr("fill", "red");

  const playgroundCircle = svg.append("circle")
    .attr("cx", 1000)  // 放大2倍
    .attr("cy", 200)  // 放大2倍
    .attr("r", 100)  // 放大2倍
    .attr("fill", "orange");

  // 绘制操场道路（白色路径）
  svg.append("path")
    .attr("d", "M0,430 Q800,700 1600,430")  // 放大2倍
    .attr("stroke", "white")
    .attr("stroke-width", 60)  // 放大2倍
    .attr("fill", "none");

  // 绘制狗的身体（矩形）
  const dogBody = dogGroup.append("rect")
    .attr("x", 200)  // 放大2倍
    .attr("y", 300)  // 放大2倍
    .attr("width", 200)  // 放大2倍
    .attr("height", 120)  // 放大2倍
    .attr("fill", "brown")
    .on("click", function() {
      shakeBody(dogBody);
    });

  // 绘制狗的头部（圆形）
  svg.append("circle")
    .attr("cx", 200)  // 放大2倍
    .attr("cy", 260)  // 放大2倍
    .attr("r", 60)  // 放大2倍
    .attr("fill", "gray");

  // 绘制狗的眼睛（圆形）
  svg.append("circle")
    .attr("cx", 170)  // 放大2倍
    .attr("cy", 240)  // 放大2倍
    .attr("r", 10)  // 放大2倍
    .attr("fill", "black");

  svg.append("circle")
    .attr("cx", 230)  // 放大2倍
    .attr("cy", 240)  // 放大2倍
    .attr("r", 10)  // 放大2倍
    .attr("fill", "black");

  // 绘制狗的鼻子（矩形）
  svg.append("rect")
    .attr("x", 190)  // 放大2倍
    .attr("y", 270)  // 放大2倍
    .attr("width", 20)  // 放大2倍
    .attr("height", 20)  // 放大2倍
    .attr("fill", "pink");

  // 绘制狗的耳朵（三角形）
  const earPoints = "160,220 140,160 180,160";  // 放大2倍
  svg.append("polygon")
    .attr("points", earPoints)
    .attr("fill", "gray");

  const otherEarPoints = "240,160 260,220 220,220";  // 放大2倍
  svg.append("polygon")
    .attr("points", otherEarPoints)
    .attr("fill", "gray");

  // 绘制狗的尾巴（路径）
  const tailPath = "M420,360 Q460,300 420,240";  // 放大2倍
  svg.append("path")
    .attr("d", tailPath)
    .attr("stroke", "brown")
    .attr("stroke-width", 6)  // 放大2倍
    .attr("fill", "none");

  // 连接狗的身体和头部的线
  const connectingLine = svg.append("line")
    .attr("x1", 1000)  // 头部中心 x 坐标
    .attr("y1", 200)  // 头部中心 y 坐标
    .attr("x2", 300)  // 身体中心 x 坐标
    .attr("y2", 360)  // 身体中心 y 坐标
    .attr("stroke", "black")
    .attr("stroke-width", 2);

  // 狗的身体抖动函数
  function shakeBody(element) {
    const duration = 200;
    const interval = 500;

    for (let i = 0; i < 3; i++) {
      element.transition()
        .duration(duration)
        .attr("y", 300 - 10)  // 放大2倍
        .transition()
        .duration(duration)
        .attr("y", 300)  // 放大2倍
        .delay(interval * i);
    }
  }

  // 狗在原地走动函数
  function walkInPlace() {
    const walkDistance = 20;  // 放大2倍
    const duration = 1000;

    dogGroup.transition()
      .duration(duration)
      .attr("transform", "translate(" + walkDistance + ", 0)")
      .transition()
      .duration(duration)
      .on("end", function() {
        // 移除连接线
        connectingLine.remove();
      });
  }

  // 自动触发移动
  moveCircleToDog(playgroundCircle);

  // 启动狗的走动
  walkInPlace();

  // 将圆形慢慢移动到狗身体的函数
  function moveCircleToDog(circle) {
    const duration = 4000;

    // 获取圆形和狗身体的位置
    const circleX = parseFloat(circle.attr("cx"));
    const circleY = parseFloat(circle.attr("cy"));
    const dogX = parseFloat(dogBody.attr("x"));
    const dogY = parseFloat(dogBody.attr("y"));

    // 计算移动的距离
    const moveX = circleX - dogX;
    const moveY = circleY - dogY;

    // 移动圆形到狗身体
    circle.transition()
      .duration(duration)
      .attr("cx", dogX)
      .attr("cy", dogY)
      .on("end", function() {
        // 移除连接线
        connectingLine.remove();
      });

    // 同时移动整个狗的组
    dogGroup.transition()
      .duration(duration)
      .attr("transform", "translate(" + moveX + "," + moveY + ")");
  }

</script>

</body>
</html>
